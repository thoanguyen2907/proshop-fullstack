{"ast":null,"code":"import _asyncToGenerator from\"/Users/thoanguyen/Library/Mobile Documents/com~apple~CloudDocs/fullstack/proshop/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/thoanguyen/Library/Mobile Documents/com~apple~CloudDocs/fullstack/proshop/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/thoanguyen/Library/Mobile Documents/com~apple~CloudDocs/fullstack/proshop/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{NavLink}from'react-router-dom';import CheckoutSteps from'../components/CheckoutSteps';import{createOrder,deliverOrder,getOrderDetail,payOrder}from'../redux/actions/orderAction';import{history}from'../utils/history/history';import axios from'axios';import{PayPalButton}from\"react-paypal-button-v2\";import{ORDER_PAY_RESET}from'../redux/constants/constants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function OrderScreen(_ref){var _order$user,_order$user2,_order$user3;var match=_ref.match;var dispatch=useDispatch();var orderId=match.params.id;var orderDetail=useSelector(function(state){return state.orderDetail;});var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var order=orderDetail.order,loading=orderDetail.loading;console.log('order',order);var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};useEffect(function(){if(!userInfo){history.push('/login');}var addPayPalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('http://localhost:5000/api/config/paypal');case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;console.log(clientId);script=document.createElement('script');script.type=\"text/javascript\";script.async=true;script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 11:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref2.apply(this,arguments);};}();if(!order||successPay){dispatch({type:ORDER_PAY_RESET});dispatch(getOrderDetail(orderId));}else if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}},[dispatch,orderId,successPay,order]);var successPaymentHandler=function successPaymentHandler(paymentResult){dispatch(payOrder(orderId,paymentResult));};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(CheckoutSteps,{step1:true,step2:true,step3:true,step4:true}),\"OrderScreen\",/*#__PURE__*/_jsxs(\"h1\",{children:[\"Order \",order===null||order===void 0?void 0:order._id]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-8\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"list-group\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name : \"}),\" \",order===null||order===void 0?void 0:(_order$user=order.user)===null||_order$user===void 0?void 0:_order$user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email: \"}),\" \",' ',/*#__PURE__*/_jsx(\"a\",{href:\"mailto: \".concat(order===null||order===void 0?void 0:(_order$user2=order.user)===null||_order$user2===void 0?void 0:_order$user2.email),children:order===null||order===void 0?void 0:(_order$user3=order.user)===null||_order$user3===void 0?void 0:_order$user3.email})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address:\"}),order===null||order===void 0?void 0:order.shippingAddress.address,\", \",order===null||order===void 0?void 0:order.shippingAddress.city,' ',order===null||order===void 0?void 0:order.shippingAddress.postalCode,\",\",' ',order===null||order===void 0?void 0:order.shippingAddress.country]}),order!==null&&order!==void 0&&order.isDelivered?/*#__PURE__*/_jsxs(\"div\",{className:\"text-danger\",children:[\"Delivered on \",order===null||order===void 0?void 0:order.deliveredAt]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-danger\",children:\"Not Delivered\"})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method: \"}),order===null||order===void 0?void 0:order.paymentMethod]}),order!==null&&order!==void 0&&order.isPaid?/*#__PURE__*/_jsxs(\"div\",{className:\"text-danger\",children:[\"Paid on \",order.paidAt]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-danger\",children:\"Not Paid\"})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Order Items\"}),(order===null||order===void 0?void 0:order.orderItems.length)===0?/*#__PURE__*/_jsx(\"h2\",{children:\"Order is empty\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"list-group\",children:order===null||order===void 0?void 0:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(\"li\",{className:\"list-group-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(\"img\",{style:{width:\"50px\",height:\"50px\"},src:item===null||item===void 0?void 0:item.image,alt:item===null||item===void 0?void 0:item.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(NavLink,{to:\"/product/\".concat(item===null||item===void 0?void 0:item.product),className:\"text-dark text-decoration-none\",children:item===null||item===void 0?void 0:item.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-4\",children:[item===null||item===void 0?void 0:item.quantity,\" x $\",item===null||item===void 0?void 0:item.price,\" = $\",(item===null||item===void 0?void 0:item.quantity)*(item===null||item===void 0?void 0:item.price)]})]})},index);})})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Items\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"$\",order===null||order===void 0?void 0:order.itemsPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"$\",order===null||order===void 0?void 0:order.shippingPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Tax\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"$\",order===null||order===void 0?void 0:order.taxPrice]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[\"$\",order===null||order===void 0?void 0:order.totalPrice]})]})}),!(order!==null&&order!==void 0&&order.isPaid)&&/*#__PURE__*/_jsxs(\"li\",{children:[loadingPay&&/*#__PURE__*/_jsx(\"h1\",{children:\"Loading ...\"}),loadingPay?/*#__PURE__*/_jsx(\"h1\",{children:\"Loading ...\"}):/*#__PURE__*/_jsx(PayPalButton,{amount:order===null||order===void 0?void 0:order.totalPrice,onSuccess:successPaymentHandler})]}),loadingDeliver&&/*#__PURE__*/_jsx(\"h3\",{children:\"Loading ...\"}),userInfo&&(userInfo===null||userInfo===void 0?void 0:userInfo.isAdmin)&&(order===null||order===void 0?void 0:order.isPaid)&&!(order!==null&&order!==void 0&&order.isDelivered)&&/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-dark\",onClick:deliverHandler,children:\"Mark As Delivered\"})})]})})})]})]});}","map":{"version":3,"sources":["/Users/thoanguyen/Library/Mobile Documents/com~apple~CloudDocs/fullstack/proshop/frontend/src/screens/OrderScreen.js"],"names":["React","useEffect","useState","useDispatch","useSelector","NavLink","CheckoutSteps","createOrder","deliverOrder","getOrderDetail","payOrder","history","axios","PayPalButton","ORDER_PAY_RESET","OrderScreen","match","dispatch","orderId","params","id","orderDetail","state","orderDeliver","loadingDeliver","loading","successDeliver","success","userLogin","userInfo","sdkReady","setSdkReady","order","console","log","orderPay","loadingPay","successPay","deliverHandler","push","addPayPalScript","get","clientId","data","script","document","createElement","type","async","src","onload","body","appendChild","isPaid","window","paypal","successPaymentHandler","paymentResult","_id","user","name","email","shippingAddress","address","city","postalCode","country","isDelivered","deliveredAt","paymentMethod","paidAt","orderItems","length","map","item","index","width","height","image","product","quantity","price","itemsPrice","shippingPrice","taxPrice","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { NavLink } from 'react-router-dom';\nimport CheckoutSteps from '../components/CheckoutSteps';\nimport { createOrder, deliverOrder, getOrderDetail, payOrder } from '../redux/actions/orderAction';\nimport { history } from '../utils/history/history';\nimport axios from 'axios'; \nimport { PayPalButton } from \"react-paypal-button-v2\";\nimport { ORDER_PAY_RESET } from '../redux/constants/constants';\n\nexport default function OrderScreen({match}) {\n    \n    const dispatch = useDispatch()\n    const orderId = match.params.id\n    const orderDetail = useSelector(state => state.orderDetail)\n\n    const orderDeliver = useSelector((state) => state.orderDeliver)\n  const { loading: loadingDeliver, success: successDeliver } = orderDeliver\n\n  const userLogin = useSelector((state) => state.userLogin)\n  const { userInfo } = userLogin\n\n    const [sdkReady, setSdkReady] = useState(false);\n    const {order, loading } = orderDetail;\n  console.log('order', order);\n    const orderPay = useSelector(state => state.orderPay)\n\n    \n    const {loading:loadingPay, success:successPay } = orderPay;\n\n    const deliverHandler = () => {\n      dispatch(deliverOrder(order))\n    }\n  \n\n    useEffect(() => {\n      if (!userInfo) {\n        history.push('/login')\n      }\n\n        const addPayPalScript = async () => {\n            const {data: clientId} = await axios.get('http://localhost:5000/api/config/paypal')\n            console.log(clientId);\n            const script = document.createElement('script')\n            script.type = \"text/javascript\"\n            script.async = true \n            script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`\n            script.onload = () => {\n                setSdkReady(true)\n            }\n            document.body.appendChild(script)\n        }\n        if(!order || successPay) {\n            dispatch({type: ORDER_PAY_RESET})\n            dispatch(getOrderDetail(orderId))\n        } else if(!order.isPaid) {\n            if(!window.paypal){\n                addPayPalScript()\n            } else {\n                setSdkReady(true)\n            }\n        }\n      \n    }, [dispatch, orderId, successPay, order]);\n\n    const successPaymentHandler = (paymentResult) => {\n        dispatch(payOrder(orderId,paymentResult ))\n    }\n    \n\n  return <div className=\"container\">\n      <CheckoutSteps step1 step2 step3 step4/>\n      OrderScreen\n      <h1>Order {order?._id}</h1>\n      <div className=\"row\">\n          <div className=\"col-8\">\n              <ul className=\"list-group\">\n                  <li className=\"list-group-item\">\n                      <h4>Shipping</h4>\n                      <p>\n                          <strong>Name : </strong> {order?.user?.name}\n                      </p>\n                      <p> \n                          <strong>Email: </strong> {' '} \n                        <a href={`mailto: ${order?.user?.email}`}>{order?.user?.email}</a>\n                      </p>\n                      <p>\n                <strong>Address:</strong>\n                {order?.shippingAddress.address}, {order?.shippingAddress.city}{' '}\n                {order?.shippingAddress.postalCode},{' '}\n                {order?.shippingAddress.country}\n              </p>\n              {order?.isDelivered ? (\n                <div  className = \"text-danger\">\n                  Delivered on {order?.deliveredAt}\n                </div>\n              ) : (\n                <div className = \"text-danger\">Not Delivered</div>\n              )}\n\n\n                  </li>\n                  <li className=\"list-group-item\">\n                  <h4>Payment Method</h4>\n              <p>\n                <strong>Method: </strong>\n                {order?.paymentMethod}\n              </p> \n              {order?.isPaid ? (\n                <div className = \"text-danger\">Paid on {order.paidAt}</div>\n              ) : (\n                <div className = \"text-danger\">Not Paid</div>\n              )}\n\n                  </li>\n                  <li className=\"list-group-item\">\n                  <h4>Order Items</h4>\n                  {order?.orderItems.length === 0 ? (\n                <h2>Order is empty</h2>\n              ) : (\n                <ul className=\"list-group\">\n                  {order?.orderItems.map((item, index) => (\n                    <li className=\"list-group-item\" key={index}>\n                      <div className=\"row\">\n                        <div className=\"col\">\n                          <img\n                            style={{width: \"50px\", height: \"50px\"}}\n                            src=  {item?.image}\n                            alt={item?.name}\n                          />\n                        </div>\n                        <div className=\"col\">\n                          <NavLink to={`/product/${item?.product}`} className=\"text-dark text-decoration-none\">\n                            {item?.name}\n                          </NavLink>\n                        </div>\n                        <div className=\"col-4\">\n                          {item?.quantity} x ${item?.price} = ${item?.quantity * item?.price}\n                        </div>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n                  </li>\n              </ul>\n          </div>\n          <div className=\"col-4\">\n          <div className= \"card\">\n            <ul>\n              <li>\n                <h2>Order Summary</h2>\n              </li>\n              <li>\n                <div className = \"row\">\n                  <div className = \"col\">Items</div>\n                  <div className = \"col\">${order?.itemsPrice}</div>\n                </div>\n              </li>\n              <li>\n                <div className = \"row\">\n                  <div className = \"col\">Shipping</div>\n                  <div className = \"col\">${order?.shippingPrice}</div>\n                </div>\n              </li>\n              <li>\n                <div className = \"row\">\n                  <div className = \"col\">Tax</div>\n                  <div className = \"col\">${order?.taxPrice}</div>\n                </div>\n              </li>\n              <li>\n                <div className = \"row\">\n                  <div className = \"col\">Total</div>\n                  <div className = \"col\">${order?.totalPrice}</div>\n                </div>\n              </li>\n              {!order?.isPaid && (\n                  <li>\n                      {loadingPay && <h1>Loading ...</h1>}\n                      {loadingPay ? <h1>Loading ...</h1> : (\n                          <PayPalButton amount={order?.totalPrice} onSuccess={successPaymentHandler}/>\n                      ) }\n                  </li>\n              )}\n\n{loadingDeliver && <h3>Loading ...</h3> }\n              {userInfo &&\n                userInfo?.isAdmin &&\n                order?.isPaid &&\n                !order?.isDelivered && (\n                  <li>\n                    <button\n                      type='button'\n                      className='btn btn-dark'\n                      onClick={deliverHandler} >\n                      Mark As Delivered\n                    </button>\n                  </li>\n                )}\n\n            </ul>\n          </div>\n        </div>\n\n      </div>\n  </div>;\n}\n"]},"metadata":{},"sourceType":"module"}